<!DOCTYPE html>
<html lang="en">
<head>
	<title>Senior Project Web App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script type src="https://raw.githubusercontent.com/mbostock/d3/master/d3.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="canvasjs.min.js"></script>
	<style>
	#div1 {margin:10px;font-size:1.25em;}
	table {border-collapse:collapse;border:1px solid #7f7f7f;}
	td {border:1px solid #7f7f7f;width:50px;height:50px;text-align:center;}
	</style>
</head>
<body>
    
    <ul class=
    <div class="containter">
        <ul class="nav nav-tabs">
           <li class="active"><a data-toggle="tab" href='#div3'>Line Graph</a></li>
           <li><a data-toggle="tab" href="#div4">Pie Chart</a></li>
           <li><a data-toggle="tab" href="#div5">Column Graph</a></i>
        </ul>
        
        <div class="tab-content">
            <div id="div3" class="tab-pane fade in active" style="height: 500px; width: 50%"></div>
            <div id="div4" class="tab-pane fade" style="height: 500px; width: 50%"></div>
            <div id="div5" class="tab-pane fade" style="height: 500px; width: 50%"></div>
        </div>
        <div class="filter-boxes">
        	<input class="filterCheckbox" type="checkbox" checked> Glennan
        	<input class="filterCheckbox" type="checkbox" checked> Nord
        	<input class="filterCheckbox" type="checkbox" checked> Olin 480
        	<input class="filterCheckbox" type="checkbox" checked> Olin 208
        	<input class="filterCheckbox" type="checkbox" checked> Rock 480
        	<input class="filterCheckbox" type="checkbox" checked> Sears 480
        	<input class="filterCheckbox" type="checkbox" checked> Sears 208
        	<input class="filterCheckbox" type="checkbox" checked> Tomlinson
        	<input class="filterCheckbox" type="checkbox" checked> White
        	<input class="filterCheckbox" type="checkbox" checked> Wick 208
        	<input class="filterCheckbox" type="checkbox" checked> Wick 480
        	<input class="filterCheckbox" type="checkbox" checked> Yost
        	<input class="filterCheckbox" type="checkbox" checked> Olin(Sum)
        	<input class="filterCheckbox" type="checkbox" checked> Sears(Sum)
        	<input class="filterCheckbox" type="checkbox" checked> Wick(Sum)
        	<br>
        	<button id="filter" onclick="filterGraphData()">Filter Results</button>
        </div>
    </div>
    
    <script>

    //Variables for the canvasjs charts we use, so that they can be updated from any function.
    var lineChart;
    var pieChart;
    var columnGraph;

    //Arrays to store the values we receive from the SQL server.
    var dateTimeArray = [];
    var glennanArray= [];
    var nordArray = [];
    var olin480Array = [];
    var olin208Array = [];
    var rock480Array = [];
    var sears480Array = [];
    var sears208Array = [];
    var tomlinsonArray = [];
    var whiteArray = [];
    var wick208Array = [];
    var wick480Array = [];
    var yostArray = [];
    var olinSumArray = [];
    var searsSumArray = [];
    var wickSumArray = [];

    //Arrays to store the line data for each chart in its proper format.
    var chartDatArray = [];
    	var glennanLine = [];
    	var nordLine = [];
    	var olin480Line = [];
    	var olin208Line = [];
    	var rock480Line = [];
    	var sears480Line = [];
    	var sears208Line = [];
    	var tomlinsonLine = [];
    	var whiteLine = [];
    	var wick208Line = [];
    	var wick480Line = [];
    	var yostLine = [];
    	var olinSumLine = [];
    	var searsSumLine = [];
    	var wickSumLine = [];

    //Averages for each sensor's data. Used by the Pie chart.
    var chartAvgArray = [];
    	var glennanAvg = 0;
    	var nordAvg = 0;
    	var olin480Avg = 0;
    	var olin208Avg = 0;
    	var rock480Avg = 0;
    	var sears480Avg = 0;
    	var sears208Avg = 0;
    	var tomlinsonAvg = 0;
    	var whiteAvg = 0;
    	var wick208Avg = 0;
    	var wick480Avg = 0;
    	var yostAvg = 0;
    	var olinSumAvg = 0;
    	var searsSumAvg = 0;
    	var wickSumAvg = 0;

    var chartCurrentArray = [];

    var filtered = false;

    //The current line we are on in the SQL. used for testing with my homemade database.
    //You should not need this once you hook it up to the live server and edit getsqlline to call the most recent line.
    var currentline = 60;


    //Sets the repeating function that causes the page to grab a new line from the database.
    var secondsBetweenUpdate = 3;
    var updateInterval = setInterval(function(){ grabNewLine() }, secondsBetweenUpdate * 1000);
    //The function currently does not clear, and as this will be hooked up to a live feed there should be no need to make it.
    //If, however, you do need to end the autoupdate, use clearInterval(updateInterval)
        
	
    //Code to filter unwanted sensors out of our graphs. Called when the "Filter Results" button is pressed.
	function filterGraphData(){
		filtered = true;	//Set the filtered variable to true, so the update method knows that the user is filtering their desired data.
		clearAllArrays();	//Clears all graph arrays, so we can fill them with only the desired sensors.

    	var lastIndex = dateTimeArray.length - 1;

        var filters = document.getElementsByClassName('filterCheckbox');	//Finds the status of each filter checkbox.
        //Go through each filter, and add the appropriate data to the arrays if the sensor is enabled.
    	if(filters[0].checked){
    		chartDatArray.push({type:"line",name:"Glennan",showInLegend:true,dataPoints:glennanLine})
    		chartAvgArray.push({ y: glennanAvg, indexLabel: "Glennan"})
	    	chartCurrentArray.push({ y: glennanArray[lastIndex], indexLabel: "Glennan"})
    	}
    	if(filters[1].checked){
    		chartDatArray.push({type:"line",name:"Nord",showInLegend:true,dataPoints:nordLine})
			chartAvgArray.push({ y: nordAvg, indexLabel: "Nord"})
	    	chartCurrentArray.push({ y: nordArray[lastIndex], indexLabel: "Nord"})
    	}
    	if(filters[2].checked){
			chartDatArray.push({type:"line",name:"Olin 480",showInLegend:true,dataPoints:olin480Line})
			chartAvgArray.push({ y: olin480Avg, indexLabel: "Olin 480"})
	    	chartCurrentArray.push({ y: olin480Array[lastIndex], indexLabel: "Olin 480"})
		}
		if(filters[3].checked){
			chartDatArray.push({type:"line",name:"Olin 208",showInLegend:true,dataPoints:olin208Line})
			chartAvgArray.push({ y: olin208Avg, indexLabel: "Olin 208"})
	    	chartCurrentArray.push({ y: olin208Array[lastIndex], indexLabel: "Olin 208"})
		}
		if(filters[4].checked){
			chartDatArray.push({type:"line",name:"Rock 480",showInLegend:true,dataPoints:rock480Line})
			chartAvgArray.push({ y: rock480Avg, indexLabel: "Rock 480"})
	    	chartCurrentArray.push({ y: rock480Array[lastIndex], indexLabel: "Rock 480"})
		}
		if(filters[5].checked){
			chartDatArray.push({type:"line",name:"Sears 480",showInLegend:true,dataPoints:sears480Line})
			chartAvgArray.push({ y: sears480Avg, indexLabel: "Sears 480"})
	    	chartCurrentArray.push({ y: sears480Array[lastIndex], indexLabel: "Sears 480"})
		}
		if(filters[6].checked){
			chartDatArray.push({type:"line",name:"Sears 208",showInLegend:true,dataPoints:sears208Line})
			chartAvgArray.push({ y: sears208Avg, indexLabel: "Sears 208"})
	    	chartCurrentArray.push({ y: sears208Array[lastIndex], indexLabel: "Sears 208"})
		}
		if(filters[7].checked){
			chartDatArray.push({type:"line",name:"Tomlinson",showInLegend:true,dataPoints:tomlinsonLine})
			chartAvgArray.push({ y: tomlinsonAvg, indexLabel: "Tomlinson"})
	    	chartCurrentArray.push({ y: tomlinsonArray[lastIndex], indexLabel: "Tomlinson"})
		}
		if(filters[8].checked){
			chartDatArray.push({type:"line",name:"White",showInLegend:true,dataPoints:whiteLine})
			chartAvgArray.push({ y: whiteAvg, indexLabel: "White"})
	    	chartCurrentArray.push({ y: whiteArray[lastIndex], indexLabel: "White"})
		}
		if(filters[9].checked){
			chartDatArray.push({type:"line",name:"Wick 208",showInLegend:true,dataPoints:wick208Line})
			chartAvgArray.push({ y: wick208Avg, indexLabel: "Wick 208"})
	    	chartCurrentArray.push({ y: wick208Array[lastIndex], indexLabel: "Wick 208"})
		}
		if(filters[10].checked){
			chartDatArray.push({type:"line",name:"Wick 480",showInLegend:true,dataPoints:wick480Line})
			chartAvgArray.push({ y: wick480Avg, indexLabel: "Wick 480"})
	    	chartCurrentArray.push({ y: wick480Array[lastIndex], indexLabel: "Wick 480"})
		}
		if(filters[11].checked){
			chartDatArray.push({type:"line",name:"Yost",showInLegend:true,dataPoints:yostLine})
			chartAvgArray.push({ y: yostAvg, indexLabel: "Yost"})
	    	chartCurrentArray.push({ y: yostArray[lastIndex], indexLabel: "Yost"})
		}
		if(filters[12].checked){
			chartDatArray.push({type:"line",name:"Olin (Sum)",showInLegend:true,dataPoints:olinSumLine})
			chartAvgArray.push({ y: olinSumAvg, indexLabel: "Olin (Sum)"})
	    	chartCurrentArray.push({ y: olinSumArray[lastIndex], indexLabel: "Olin (Sum)"})
		}
		if(filters[13].checked){
			chartDatArray.push({type:"line",name:"Sears (Sum)",showInLegend:true,dataPoints:searsSumLine})
			chartAvgArray.push({ y: searsSumAvg, indexLabel: "Sears (Sum)"})
	    	chartCurrentArray.push({ y: searsSumArray[lastIndex], indexLabel: "Sears (Sum)"})
		}
		if(filters[14].checked){
			chartDatArray.push({type:"line",name:"Wick (Sum)",showInLegend:true,dataPoints:wickSumLine})
			chartAvgArray.push({ y: wickSumAvg, indexLabel: "Wick (Sum)"})
	    	chartCurrentArray.push({ y: wickSumArray[lastIndex], indexLabel: "Wick (Sum)"})
		}
		//Redraw our charts so they display the proper, newly-filtered, data.
    	renderAllCharts();

	}

	//Calls getdata.php to grab the initial data.
	function getSQL(){
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		} else {
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function(){
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
				var received = trimResponse(xmlhttp.responseText);
				var obj = JSON.parse(received);
				var resultArray = obj.sensordata;
				parseResults(resultArray);
			}
		};
		xmlhttp.open("GET","getdata.php",true);
		xmlhttp.send();
	}

	//Grabs a single new line of data.
	function grabNewLine(){
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		} else {
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function(){
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
				currentline += 1;	//Increment currentline so that we keep progressing through the SQL.
				var received = trimResponse(xmlhttp.responseText);
				var obj = JSON.parse(received);
				var result = obj.sensordata[0];
				parseNewLine(result);
			}
		};
		var baseget = "getsqlline.php?line=";
		var finalget = baseget.concat(currentline);
		xmlhttp.open("GET", finalget ,true);
		xmlhttp.send();
	}

	//When received, the php data from the table is surrounded with HTML tags, which will screw up the parsing.
	//This is a helper function to strip those tags, leaving us with our desired JSON object.
	function trimResponse(responseString){
		var trimmed = responseString.replace("<!DOCTYPE html>", '');
		trimmed = trimmed.replace("<html>", '');
		trimmed = trimmed.replace("<body>", '');
		trimmed = trimmed.replace("</body>", '');
		trimmed = trimmed.replace("</html>", '');
		return trimmed
	}

	//This helper function puts the data from the parsed JSON table into the arrays we have set up to store them.
	function parseResults(resultArray){
		for(var i = 0; i < resultArray.length; i++){
			dateTimeArray.push(resultArray[i].Date_Time);
			glennanArray.push(parseInt(resultArray[i].Glennan));
			nordArray.push(parseInt(resultArray[i].Nord));
			olin480Array.push(parseInt(resultArray[i].Olin_480));
			olin208Array.push(parseInt(resultArray[i].Olin_208));
			rock480Array.push(parseInt(resultArray[i].Rock_480));
			sears480Array.push(parseInt(resultArray[i].Sears_480));
			sears208Array.push(parseInt(resultArray[i].Sears_208));
			tomlinsonArray.push(parseInt(resultArray[i].Tomlinson));
			whiteArray.push(parseInt(resultArray[i].White));
			wick208Array.push(parseInt(resultArray[i].Wick_208));
			wick480Array.push(parseInt(resultArray[i].Wick_480));
			yostArray.push(parseInt(resultArray[i].Yost));
			olinSumArray.push(parseInt(resultArray[i].Olin_Sum));
			searsSumArray.push(parseInt(resultArray[i].Sears_Sum));
			wickSumArray.push(parseInt(resultArray[i].Wick_Sum));
		}

		//now that the JSON data has been parsed, the arrays are populated and we can run our Chart setup.
		this.drawChart();
		this.pieChart();
		this.columnGraph();
	}

	//Parse our new line of data.
	function parseNewLine(result){
		dateTimeArray.push(result.Date_Time);
		glennanArray.push(parseInt(result.Glennan));
		nordArray.push(parseInt(result.Nord));
		olin480Array.push(parseInt(result.Olin_480));
		olin208Array.push(parseInt(result.Olin_208));
		rock480Array.push(parseInt(result.Rock_480));
		sears480Array.push(parseInt(result.Sears_480));
		sears208Array.push(parseInt(result.Sears_208));
		tomlinsonArray.push(parseInt(result.Tomlinson));
		whiteArray.push(parseInt(result.White));
		wick208Array.push(parseInt(result.Wick_208));
		wick480Array.push(parseInt(result.Wick_480));
		yostArray.push(parseInt(result.Yost));
		olinSumArray.push(parseInt(result.Olin_Sum));
		searsSumArray.push(parseInt(result.Sears_Sum));
		wickSumArray.push(parseInt(result.Wick_Sum));

		//Update all of our charts to include the new data
		this.updateAll();
	}

	//Helper function to handle updating all charts.
	function updateAll(){
		updateLineData();	//Updates the individual arrays of line chart data.
		getAllAvgs();		//Updates the individual average variables
		//If a filter is in place, filterGraphData already handles rerendering the graphs.
		if(filtered){
			filterGraphData();
		}
		//Otherwise, we do the steps to rerender the graphs.
		else{
			clearAllArrays();
			updateAllArrays();
			renderAllCharts();
		}
	}

	//Find the average value in an array.
	function getAverage(intArray){
		var sum = 0;
		for(var i = 0; i < intArray.length; i++){
			if(!isNaN(intArray[i])){
				sum += intArray[i];
			}
		}
		var avg = sum / intArray.length;
		return avg;
	}

	//Graphing function for the line chart.
	function drawChart(){
		initializeLineData()
		updateLineArray()

		lineChart = new CanvasJS.Chart("div3", {
              data: chartDatArray
        });
 
        lineChart.render();
	}

	//Populate the line data for our line plot.
	function initializeLineData(){
		for(var r = 0; r < dateTimeArray.length; r++){
			glennanLine.push({x: r, y: glennanArray[r], label: dateTimeArray[r]})
			nordLine.push({x: r, y: nordArray[r], label: dateTimeArray[r]})
			olin480Line.push({x: r, y: olin480Array[r], label: dateTimeArray[r]})
			olin208Line.push({x: r, y: olin208Array[r], label: dateTimeArray[r]})
			rock480Line.push({x: r, y: rock480Array[r], label: dateTimeArray[r]})
			sears480Line.push({x: r, y: sears480Array[r], label: dateTimeArray[r]})
			sears208Line.push({x: r, y: sears208Array[r], label: dateTimeArray[r]})
			tomlinsonLine.push({x: r, y: tomlinsonArray[r], label: dateTimeArray[r]})
			whiteLine.push({x: r, y: whiteArray[r], label: dateTimeArray[r]})
			wick208Line.push({x: r, y: wick208Array[r], label: dateTimeArray[r]})
			wick480Line.push({x: r, y: wick480Array[r], label: dateTimeArray[r]})
			yostLine.push({x: r, y: yostArray[r], label: dateTimeArray[r]})
			olinSumLine.push({x: r, y: olinSumArray[r], label: dateTimeArray[r]})
			searsSumLine.push({x: r, y: searsSumArray[r], label: dateTimeArray[r]})
			wickSumLine.push({x: r, y: wickSumArray[r], label: dateTimeArray[r]})
		}
	}

	//Adds a new data point to our line chart.
	function updateLineData(){
		var r = (dateTimeArray.length - 1);
		glennanLine.push({x: r, y: glennanArray[r], label: dateTimeArray[r]})
		nordLine.push({x: r, y: nordArray[r], label: dateTimeArray[r]})
		olin480Line.push({x: r, y: olin480Array[r], label: dateTimeArray[r]})
		olin208Line.push({x: r, y: olin208Array[r], label: dateTimeArray[r]})
		rock480Line.push({x: r, y: rock480Array[r], label: dateTimeArray[r]})
		sears480Line.push({x: r, y: sears480Array[r], label: dateTimeArray[r]})
		sears208Line.push({x: r, y: sears208Array[r], label: dateTimeArray[r]})
		tomlinsonLine.push({x: r, y: tomlinsonArray[r], label: dateTimeArray[r]})
		whiteLine.push({x: r, y: whiteArray[r], label: dateTimeArray[r]})
		wick208Line.push({x: r, y: wick208Array[r], label: dateTimeArray[r]})
		wick480Line.push({x: r, y: wick480Array[r], label: dateTimeArray[r]})
		yostLine.push({x: r, y: yostArray[r], label: dateTimeArray[r]})
		olinSumLine.push({x: r, y: olinSumArray[r], label: dateTimeArray[r]})
		searsSumLine.push({x: r, y: searsSumArray[r], label: dateTimeArray[r]})
		wickSumLine.push({x: r, y: wickSumArray[r], label: dateTimeArray[r]})

		trimLines()		//If you want the line chart to gain data points over time, remove this.
	}

	//Trim the line arrays to a desired length, to make the plot stay at a constant resolution of data.
	function trimLines(){
		var desiredLength = 60;
		if(glennanLine.length > desiredLength){
			glennanLine.shift();
		}
		if(nordLine.length > desiredLength){
			nordLine.shift();
		}
		if(olin480Line.length > desiredLength){
			olin480Line.shift();
		}
		if(olin208Line.length > desiredLength){
			olin208Line.shift();
		}
		if(rock480Line.length > desiredLength){
			rock480Line.shift();
		}
		if(sears480Line.length > desiredLength){
			sears480Line.shift();
		}
		if(sears208Line.length > desiredLength){
			sears208Line.shift();
		}
		if(tomlinsonLine.length > desiredLength){
			tomlinsonLine.shift();
		}
		if(whiteLine.length > desiredLength){
			whiteLine.shift();
		}
		if(wick208Line.length > desiredLength){
			wick208Line.shift();
		}
		if(wick480Line.length > desiredLength){
			wick480Line.shift();
		}
		if(yostLine.length > desiredLength){
			yostLine.shift();
		}
		if(olinSumLine.length > desiredLength){
			olinSumLine.shift();
		}
		if(searsSumLine.length > desiredLength){
			searsSumLine.shift();
		}
		if(wickSumLine.length > desiredLength){
			wickSumLine.shift();
		}
	}

	//Push all individual line arrays into the data array for our line plot.
	//This should only be called when a filter is not active - filterGraphData does this job.
	function updateLineArray(){
		chartDatArray.push({type:"line",name:"Glennan",showInLegend:true,dataPoints:glennanLine})
		chartDatArray.push({type:"line",name:"Nord",showInLegend:true,dataPoints:nordLine})
		chartDatArray.push({type:"line",name:"Olin 480",showInLegend:true,dataPoints:olin480Line})
		chartDatArray.push({type:"line",name:"Olin 208",showInLegend:true,dataPoints:olin208Line})
		chartDatArray.push({type:"line",name:"Rock 480",showInLegend:true,dataPoints:rock480Line})
		chartDatArray.push({type:"line",name:"Sears 480",showInLegend:true,dataPoints:sears480Line})
		chartDatArray.push({type:"line",name:"Sears 208",showInLegend:true,dataPoints:sears208Line})
		chartDatArray.push({type:"line",name:"Tomlinson",showInLegend:true,dataPoints:tomlinsonLine})
		chartDatArray.push({type:"line",name:"White",showInLegend:true,dataPoints:whiteLine})
		chartDatArray.push({type:"line",name:"Wick 208",showInLegend:true,dataPoints:wick208Line})
		chartDatArray.push({type:"line",name:"Wick 480",showInLegend:true,dataPoints:wick480Line})
		chartDatArray.push({type:"line",name:"Yost",showInLegend:true,dataPoints:yostLine})
		chartDatArray.push({type:"line",name:"Olin (Sum)",showInLegend:true,dataPoints:olinSumLine})
		chartDatArray.push({type:"line",name:"Sears (Sum)",showInLegend:true,dataPoints:searsSumLine})
		chartDatArray.push({type:"line",name:"Wick (Sum)",showInLegend:true,dataPoints:wickSumLine})
	}

	//Remove all data from the line plot's data array.
	function clearLineArray(){
		while(chartDatArray.length > 0){
        	chartDatArray.shift();
        }
	}
    
    function pieChart() {
        getAllAvgs()
        updateAvgArray()
        //Similar to the previous chart, but now is a pie chart instead
        //Also used div4 instead of div3
        //-AD
        pieChart = new CanvasJS.Chart("div4", {
        	legend: {
        		maxWidth: 350,
        		itemWidth: 120
        	},
        	data: [{
        		//In the data points, trying to get the value from each datArray as each y-value in each arc. -AD
                type: "pie",
                showInLegend: true,
                legendText: "{indexLabel}",
                dataPoints: chartAvgArray
             }]
         });
         //Named it differently to differentiate the two charts. -AD
         pieChart.render();
    }

    //Populate the array for our pie chart with the averages of the data
    function getAllAvgs(){
    	glennanAvg = getAverage(glennanArray)
    	nordAvg = getAverage(nordArray)
    	olin480Avg = getAverage(olin480Array)
    	olin208Avg = getAverage(olin208Array)
    	rock480Avg = getAverage(rock480Array)
    	sears480Avg = getAverage(sears480Array)
    	sears208Avg = getAverage(sears208Array)
    	tomlinsonAvg = getAverage(tomlinsonArray)
    	whiteAvg = getAverage(whiteArray)
    	wick208Avg = getAverage(wick208Array)
    	wick480Avg = getAverage(wick480Array)
    	yostAvg = getAverage(yostArray)
    	olinSumAvg = getAverage(olinSumArray)
    	searsSumAvg = getAverage(searsSumArray)
    	wickSumAvg = getAverage(wickSumArray)
    }

    //Push all individual averages into the data array for our pie chart.
	//This should only be called when a filter is not active - filterGraphData does this job.
    function updateAvgArray(){
    	chartAvgArray.push({ y: glennanAvg, indexLabel: "Glennan"})
		chartAvgArray.push({ y: nordAvg, indexLabel: "Nord"})
		chartAvgArray.push({ y: olin480Avg, indexLabel: "Olin 408"})
		chartAvgArray.push({ y: olin208Avg, indexLabel: "Olin 208"})
		chartAvgArray.push({ y: rock480Avg, indexLabel: "Rock 480"})
		chartAvgArray.push({ y: sears480Avg, indexLabel: "Sears 480"})
		chartAvgArray.push({ y: sears208Avg, indexLabel: "Sears 208"})
		chartAvgArray.push({ y: tomlinsonAvg, indexLabel: "Tomlinson"})
		chartAvgArray.push({ y: whiteAvg, indexLabel: "White"})
		chartAvgArray.push({ y: wick208Avg, indexLabel: "Wick 208"})
		chartAvgArray.push({ y: wick480Avg, indexLabel: "Wick 480"})
		chartAvgArray.push({ y: yostAvg, indexLabel: "Yost"})
		chartAvgArray.push({ y: olinSumAvg, indexLabel: "Olin (Sum)"})
		chartAvgArray.push({ y: searsSumAvg, indexLabel: "Sears (Sum)"})
		chartAvgArray.push({ y: wickSumAvg, indexLabel: "Wick (Sum)"})
    }

    //Remove all data from our pie chart's data array.
    function clearAvgArray(){
    	while(chartAvgArray.length > 0){
        	chartAvgArray.shift();
        }
    }

    function columnGraph() {
        updateCurrentArray()
        //Similar to the previous chart, but now is a bar graph instead
        //Also used div5 instead of div4
        //-AD
        columnGraph = new CanvasJS.Chart("div5", {
        	legend: {
        		maxWidth: 350,
        		itemWidth: 120
        	},
        	data: [{type: "column",
        		dataPoints: chartCurrentArray
        	}]
        });
        columnGraph.render();                           
    }

    //Find the most recent entries in each sensor's array, and push them into our column graph's data array.
	//This should only be called when a filter is not active - filterGraphData does this job.
    function updateCurrentArray(){
    	var lastIndex = dateTimeArray.length - 1;

    	chartCurrentArray.push({ y: glennanArray[lastIndex], indexLabel: "Glennan"})
    	chartCurrentArray.push({ y: nordArray[lastIndex], indexLabel: "Nord"})
    	chartCurrentArray.push({ y: olin480Array[lastIndex], indexLabel: "Olin 480"})
    	chartCurrentArray.push({ y: olin208Array[lastIndex], indexLabel: "Olin 208"})
    	chartCurrentArray.push({ y: rock480Array[lastIndex], indexLabel: "Rock 480"})
    	chartCurrentArray.push({ y: sears480Array[lastIndex], indexLabel: "Sears 480"})
    	chartCurrentArray.push({ y: sears208Array[lastIndex], indexLabel: "Sears 208"})
    	chartCurrentArray.push({ y: tomlinsonArray[lastIndex], indexLabel: "Tomlinson"})
    	chartCurrentArray.push({ y: whiteArray[lastIndex], indexLabel: "White"})
    	chartCurrentArray.push({ y: wick208Array[lastIndex], indexLabel: "Wick 208"})
    	chartCurrentArray.push({ y: wick480Array[lastIndex], indexLabel: "Wick 480"})
    	chartCurrentArray.push({ y: yostArray[lastIndex], indexLabel: "Yost"})
    	chartCurrentArray.push({ y: olinSumArray[lastIndex], indexLabel: "Olin (Sum)"})
    	chartCurrentArray.push({ y: searsSumArray[lastIndex], indexLabel: "Sears (Sum)"})
    	chartCurrentArray.push({ y: wickSumArray[lastIndex], indexLabel: "Wick (Sum)"})
    }

    //Remove all data from our column graph's data array.
    function clearCurrentArray(){
    	while(chartCurrentArray.length > 0){
        	chartCurrentArray.shift();
        }
    }

    //Clear all of our graphs' data arrays.
    function clearAllArrays(){
    	clearLineArray();
    	clearAvgArray();
    	clearCurrentArray();
    }

    //Update the data in alll of our graphs' data arrays.
    function updateAllArrays(){
    	updateLineArray();
    	updateAvgArray();
    	updateCurrentArray();
    }

    //Draw all of our charts.
    function renderAllCharts(){
    	lineChart.render();
    	pieChart.render();
    	columnGraph.render();
    }
    
    //This only calls getSQL at the moment. If you want to draw other things with Javascript on this page,
    //Add the relevant code here.
	function drawAll(){
		this.getSQL();
	}

window.onload=drawAll; 
</script>
</body>
</html>
