<!DOCTYPE html>
<html lang="en">
<head>
	<title>Senior Project Web App</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script type src="https://raw.githubusercontent.com/mbostock/d3/master/d3.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="canvasjs.min.js"></script>
	<style>
	#div1 {margin:10px;font-size:1.25em;}
	table {border-collapse:collapse;border:1px solid #7f7f7f;}
	td {border:1px solid #7f7f7f;width:50px;height:50px;text-align:center;}
	</style>
</head>
<body>
    
    <ul class=
    <div class="containter">
        <ul class="nav nav-tabs">
           <li class="active"><a data-toggle="tab" href='#div3'>Line Graph</a></li>
           <li><a data-toggle="tab" href="#div4">Pie Chart</a></li>
        </ul>
        
        <div class="tab-content">
            <div id="div3" class="tab-pane fade in active" style="height: 500px; width: 50%"></div>
            <div id="div4" class="tab-pane fade" style="height: 500px; width: 50%"></div>
        </div>
        <div class="filter-boxes">
        	<input class="filterCheckbox" type="checkbox" checked> Glennan
        	<input class="filterCheckbox" type="checkbox" checked> Nord
        	<input class="filterCheckbox" type="checkbox" checked> Olin 480
        	<input class="filterCheckbox" type="checkbox" checked> Olin 208
        	<input class="filterCheckbox" type="checkbox" checked> Rock 480
        	<input class="filterCheckbox" type="checkbox" checked> Sears 480
        	<input class="filterCheckbox" type="checkbox" checked> Sears 208
        	<input class="filterCheckbox" type="checkbox" checked> Tomlinson
        	<input class="filterCheckbox" type="checkbox" checked> White
        	<input class="filterCheckbox" type="checkbox" checked> Wick 208
        	<input class="filterCheckbox" type="checkbox" checked> Wick 480
        	<input class="filterCheckbox" type="checkbox" checked> Yost
        	<input class="filterCheckbox" type="checkbox" checked> Olin(Sum)
        	<input class="filterCheckbox" type="checkbox" checked> Sears(Sum)
        	<input class="filterCheckbox" type="checkbox" checked> Wick(Sum)
        	<br>
        	<button id="filter">Click Test</button>
        </div>
    </div>

	<div id="viz"></div>
	<div id="div1"></div>
	<div id="div2"></div>
    
    <script>

    var lineChart;

    var dateTimeArray = [];
    var glennanArray= [];
    var nordArray = [];
    var olin480Array = [];
    var olin208Array = [];
    var rock480Array = [];
    var sears480Array = [];
    var sears208Array = [];
    var tomlinsonArray = [];
    var whiteArray = [];
    var wick208Array = [];
    var wick480Array = [];
    var yostArray = [];
    var olinSumArray = [];
    var searsSumArray = [];
    var wickSumArray = [];

    var chartDatArray = [];
    	var glennanLine = [];
    	var nordLine = [];
    	var olin480Line = [];
    	var olin208Line = [];
    	var rock480Line = [];
    	var sears480Line = [];
    	var sears208Line = [];
    	var tomlinsonLine = [];
    	var whiteLine = [];
    	var wick208Line = [];
    	var wick480Line = [];
    	var yostLine = [];
    	var olinSumLine = [];
    	var searsSumLine = [];
    	var wickSumLine = [];
        
	//Note: Currently CSV drawing via d3 does not appear to be functional on some browsers
	//(tested with Chrome, IE, Edge, Firefox. Only worked with Firefox)
	//Thus, may need to eventually change lookup method.
	//But, the CSV is for testing at the moment so this is not strictly necessary.
	function drawCSV(){
		//Using week1monnoteless instead of the full 2 weeks to avoid crashing firefox.
		d3.text("week1monnoteless.csv", function(datasetText) {
			var parsedCSV = d3.csv.parseRows(datasetText);
		
			var sampleHTML = d3.select("#viz")
				.append("table")
				.style("border-collapse", "collapse")
				.style("border", "2px black solid")
			
				.selectAll("tr")
				.data(parsedCSV)
				.enter().append("tr")
			
				.selectAll("td")
				.data(function(d) {return d;})
				.enter().append("td")
				.style("border", "1px black solid")
				.style("padding", "5px")
				.on("mouseover", function(){d3.select(this).style("background-color", "aliceblue")})
				.on("mouseover", function(){d3.select(this).style("background-color", "white")})
				.text(function(d){return d;})
				.style("font-size", "12px");
		});
	}

	function getSQL(){
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		} else {
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function(){
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
				var received = trimResponse(xmlhttp.responseText);
				var obj = JSON.parse(received);
				var resultArray = obj.sensordata;
				parseResults(obj.sensordata);
			}
		};
		xmlhttp.open("GET","getdata2.php",true);
		xmlhttp.send();
	}

	//When received, the php data from the table is surrounded with HTML tags, which will screw up the parsing.
	//This is a helper function to strip those tags, leaving us with our desired JSON object.
	function trimResponse(responseString){
		var trimmed = responseString.replace("<!DOCTYPE html>", '');
		trimmed = trimmed.replace("<html>", '');
		trimmed = trimmed.replace("<body>", '');
		trimmed = trimmed.replace("</body>", '');
		trimmed = trimmed.replace("</html>", '');
		return trimmed
	}

	//This helper function puts the data from the parsed JSON table into the arrays we have set up to store them.
	function parseResults(resultArray){
		for(var i = 0; i < resultArray.length; i++){
			dateTimeArray.push(resultArray[i].Date_Time);
			glennanArray.push(parseInt(resultArray[i].Glennan));
			nordArray.push(parseInt(resultArray[i].Nord));
			olin480Array.push(parseInt(resultArray[i].Olin_480));
			olin208Array.push(parseInt(resultArray[i].Olin_208));
			rock480Array.push(parseInt(resultArray[i].Rock_480));
			sears480Array.push(parseInt(resultArray[i].Sears_480));
			sears208Array.push(parseInt(resultArray[i].Sears_208));
			tomlinsonArray.push(parseInt(resultArray[i].Tomlinson));
			whiteArray.push(parseInt(resultArray[i].White));
			wick208Array.push(parseInt(resultArray[i].Wick_208));
			wick480Array.push(parseInt(resultArray[i].Wick_480));
			yostArray.push(parseInt(resultArray[i].Yost));
			olinSumArray.push(parseInt(resultArray[i].Olin_Sum));
			searsSumArray.push(parseInt(resultArray[i].Sears_Sum));
			wickSumArray.push(parseInt(resultArray[i].Wick_Sum));
		}

		this.drawChart();	//now that the JSON data has been parsed, the arrays are populated and we can run our Chart setup.
	}
	
	var totalRows = 5;
	var cellsInRow = 5;
	var min = 1;
	var max = 10;
	var randArray = [[], [], [], [], []];
	for(var r = 0; r < 5; r++){
		for(var c = 0; c < 5; c++){
			var randNum = Math.floor(Math.random() * (max - min + 1)) + min;
			randArray[r].push(randNum);
		}
	}
	var avgs = [0, 0, 0, 0, 0];
	var tableRows = 0;


	//Drawtable is used simply for testing for my other functions at the moment.
	//Eventually, it will be removed and the average/graphing functions will be
	//Hooked up to the csv-parsing table method. -CG
	function drawTable() {
        // get the reference for the body
   	    var div1 = document.getElementById('div1');
 
   	    // creates a <table> element
   	    var tbl = document.createElement("table");
 
   	    // creating rows
   	    for (var r = 0; r < totalRows; r++) {
   	        var row = document.createElement("tr");
	     
		    // create cells in row
   	    	for (var c = 0; c < cellsInRow; c++) {
   	        	var cell = document.createElement("td");
				var getRandom = randArray[r][c];
				avgs[c] = avgs[c] + getRandom;
       	    	var cellText = document.createTextNode(getRandom);
           		cell.appendChild(cellText);
           		row.appendChild(cell);
        	}         
			tbl.appendChild(row); // add the row to the end of the table body
			tableRows++;
    	}
	    div1.appendChild(tbl); // appends <table> into <div1>
	}
	//Compiles the averages for each value. Simple stuff.
	//This will be fed into the graphing function. -CG
	function drawAverages(){
		var div2 = document.getElementById('div2');
		var tbl = document.createElement("table");
		var row = document.createElement("tr");

		for(var c = 0; c < cellsInRow; c++){
			var cell = document.createElement("td");
			var cellText = document.createTextNode(avgs[c]/totalRows);
			cell.appendChild(cellText);
			row.appendChild(cell);
		}
		tbl.appendChild(row);
		div2.appendChild(tbl);
	}

	//Graphing function. Currently draws a Line Graph hooked up to the webapp.
	function drawChart(){
		initializeLineData()

		lineChart = new CanvasJS.Chart("div3", {
              data: chartDatArray
        });
 
        lineChart.render();

        //Helper Function for filtering of data: on button press, will change the chart's data array to only include
        //Selected data sets.
        $("#filter").click(function() {
        	while(chartDatArray.length > 0){
        		chartDatArray.shift();
        	}
        	var filters = document.getElementsByClassName('filterCheckbox');	
    		if(filters[0].checked){
    			chartDatArray.push({type:"line",name:"Glennan",showInLegend:true,dataPoints:glennanLine})
    		}
    		if(filters[1].checked){
    			chartDatArray.push({type:"line",name:"Nord",showInLegend:true,dataPoints:nordLine})
    		}
    		if(filters[2].checked){
				chartDatArray.push({type:"line",name:"Olin 480",showInLegend:true,dataPoints:olin480Line})
			}
			if(filters[3].checked){
				chartDatArray.push({type:"line",name:"Olin 208",showInLegend:true,dataPoints:olin208Line})
			}
			if(filters[4].checked){
				chartDatArray.push({type:"line",name:"Rock 480",showInLegend:true,dataPoints:rock480Line})
			}
			if(filters[5].checked){
				chartDatArray.push({type:"line",name:"Sears 480",showInLegend:true,dataPoints:sears480Line})
			}
			if(filters[6].checked){
				chartDatArray.push({type:"line",name:"Sears 208",showInLegend:true,dataPoints:sears208Line})
			}
			if(filters[7].checked){
				chartDatArray.push({type:"line",name:"Tomlinson",showInLegend:true,dataPoints:tomlinsonLine})
			}
			if(filters[8].checked){
				chartDatArray.push({type:"line",name:"White",showInLegend:true,dataPoints:whiteLine})
			}
			if(filters[9].checked){
				chartDatArray.push({type:"line",name:"Wick 208",showInLegend:true,dataPoints:wick208Line})
			}
			if(filters[10].checked){
				chartDatArray.push({type:"line",name:"Wick 480",showInLegend:true,dataPoints:wick480Line})
			}
			if(filters[11].checked){
				chartDatArray.push({type:"line",name:"Yost",showInLegend:true,dataPoints:yostLine})
			}
			if(filters[12].checked){
				chartDatArray.push({type:"line",name:"Olin (Sum)",showInLegend:true,dataPoints:olinSumLine})
			}
			if(filters[13].checked){
				chartDatArray.push({type:"line",name:"Sears (Sum)",showInLegend:true,dataPoints:searsSumLine})
			}
			if(filters[14].checked){
				chartDatArray.push({type:"line",name:"Wick (Sum)",showInLegend:true,dataPoints:wickSumLine})
			}
    		lineChart.render();
        })
	}

	//Populate the line data for our line plot.
	function initializeLineData(){
		console.log("test");
		for(var i = 0; i < 5; i++){
			console.log("test")
		}
		console.log(dateTimeArray.length)
		for(var r = 0; r < dateTimeArray.length; r++){
			glennanLine.push({y: glennanArray[r], label: dateTimeArray[r]})
			nordLine.push({y: nordArray[r], label: dateTimeArray[r]})
			olin480Line.push({y: olin480Array[r], label: dateTimeArray[r]})
			olin208Line.push({y: olin208Array[r], label: dateTimeArray[r]})
			rock480Line.push({y: rock480Array[r], label: dateTimeArray[r]})
			sears480Line.push({y: sears480Array[r], label: dateTimeArray[r]})
			sears208Line.push({y: sears208Array[r], label: dateTimeArray[r]})
			tomlinsonLine.push({y: tomlinsonArray[r], label: dateTimeArray[r]})
			whiteLine.push({y: whiteArray[r], label: dateTimeArray[r]})
			wick208Line.push({y: wick208Array[r], label: dateTimeArray[r]})
			wick480Line.push({y: wick480Array[r], label: dateTimeArray[r]})
			yostLine.push({y: yostArray[r], label: dateTimeArray[r]})
			olinSumLine.push({y: olinSumArray[r], label: dateTimeArray[r]})
			searsSumLine.push({y: searsSumArray[r], label: dateTimeArray[r]})
			wickSumLine.push({y: wickSumArray[r], label: dateTimeArray[r]})
		}
		chartDatArray.push({type:"line",name:"Glennan",showInLegend:true,dataPoints:glennanLine})
		chartDatArray.push({type:"line",name:"Nord",showInLegend:true,dataPoints:nordLine})
		chartDatArray.push({type:"line",name:"Olin 480",showInLegend:true,dataPoints:olin480Line})
		chartDatArray.push({type:"line",name:"Olin 208",showInLegend:true,dataPoints:olin208Line})
		chartDatArray.push({type:"line",name:"Rock 480",showInLegend:true,dataPoints:rock480Line})
		chartDatArray.push({type:"line",name:"Sears 480",showInLegend:true,dataPoints:sears480Line})
		chartDatArray.push({type:"line",name:"Sears 208",showInLegend:true,dataPoints:sears208Line})
		chartDatArray.push({type:"line",name:"Tomlinson",showInLegend:true,dataPoints:tomlinsonLine})
		chartDatArray.push({type:"line",name:"White",showInLegend:true,dataPoints:whiteLine})
		chartDatArray.push({type:"line",name:"Wick 208",showInLegend:true,dataPoints:wick208Line})
		chartDatArray.push({type:"line",name:"Wick 480",showInLegend:true,dataPoints:wick480Line})
		chartDatArray.push({type:"line",name:"Yost",showInLegend:true,dataPoints:yostLine})
		chartDatArray.push({type:"line",name:"Olin (Sum)",showInLegend:true,dataPoints:olinSumLine})
		chartDatArray.push({type:"line",name:"Sears (Sum)",showInLegend:true,dataPoints:searsSumLine})
		chartDatArray.push({type:"line",name:"Wick (Sum)",showInLegend:true,dataPoints:wickSumLine})
	}
    
    function pieChart() {
        
        //I am going to use averages for the pie chart -AD
        var sum1 = 0;
        for(var r = 0; r < totalRows; r++){
			sum1 += parseInt(randArray[r][0], 10);
		}
        var avg1 = sum1/totalRows;
        
        var sum2 = 0;
        for(var r = 0; r < totalRows; r++){
			sum2 += parseInt(randArray[r][1], 10);
		}
        var avg2 = sum2/totalRows;
        
        var sum3 = 0;
        for(var r = 0; r < totalRows; r++){
            sum3 += parseInt(randArray[r][2], 10);
        }
        var avg3 = sum1/totalRows;
        
        var sum4 = 0;
        for(var r = 0; r < totalRows; r++){
            sum4 += parseInt(randArray[r][3], 10);
        }
        var avg4 = sum4/totalRows;
        
        var sum5 = 0;
        for(var r = 0; r < totalRows; r++){
			sum5 += parseInt(randArray[r][0], 10);
		}
        var avg5 = sum5/totalRows;
        
        
        //Similar to the previous chart, but now is a pie chart instead
        //Also used div4 instead of div3
        //-AD
        var pieChart = new CanvasJS.Chart("div4", {
                                          legend: {
                                          maxWidth: 350,
                                          itemWidth: 120
                                          },
                                          
                                          
                                          data: [
                                                 {
                                                 //In the data points, trying to get the value from each datArray as each y-value in each arc. -AD
                                                 type: "pie",
                                                 showInLegend: true,
                                                 legendText: "{indexLabel}",
                                                 dataPoints: [
                                                              { y: avg1, indexLabel: "arc1"},
                                                              { y: avg2, indexLabel: "arc2"},
                                                              { y: avg3, indexLabel: "arc3"},
                                                              { y: avg4, indexLabel: "arc4"},
                                                              { y: avg5, indexLabel: "arc5"}
                                                              ]
                                                 }
                                                 ]
                                          });
                                          //Named it differently to differentiate the two charts. -AD
                                          pieChart.render();
                                          
    }
    
	function drawAll(){
		this.getSQL();
		this.drawTable();
		this.drawAverages();
		//this.drawChart();
        this.pieChart();
		//this.drawCSV();
	}

window.onload=drawAll; 
</script>
</body>
</html>
